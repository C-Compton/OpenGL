\hypertarget{motionplus_8c}{\section{motionplus.\-c \-File \-Reference}
\label{motionplus_8c}\index{motionplus.\-c@{motionplus.\-c}}
}


\-Motion \-Plus expansion device.  


{\ttfamily \#include $<$stdio.\-h$>$}\*
{\ttfamily \#include $<$stdlib.\-h$>$}\*
{\ttfamily \#include $<$math.\-h$>$}\*
{\ttfamily \#include \char`\"{}definitions.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}wiic\-\_\-internal.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}dynamics.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}events.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}motionplus.\-h\char`\"{}}\*
\subsection*{\-Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{motionplus_8c_a001ca4a571a8fc67ed0f3a16c50f05e0}{calculate\-\_\-gyro\-\_\-rates} (struct \hyperlink{structmotion__plus__t}{motion\-\_\-plus\-\_\-t} $\ast$mp, struct \hyperlink{structang3s__t}{ang3s\-\_\-t} $\ast$in, struct \hyperlink{structang3f__t}{ang3f\-\_\-t} $\ast$out)
\begin{DoxyCompactList}\small\item\em \-Convert raw data in deg/sec angular rates. \end{DoxyCompactList}\item 
void \hyperlink{motionplus_8c_a0f2f989bf76980a687ee493613fdc896}{motion\-\_\-plus\-\_\-event} (struct \hyperlink{structmotion__plus__t}{motion\-\_\-plus\-\_\-t} $\ast$mp, \hyperlink{wiic__macros_8h_a0c8186d9b9b7880309c27230bbb5e69d}{byte} $\ast$msg)
\begin{DoxyCompactList}\small\item\em \-Handle \-Motion \-Plus event. \end{DoxyCompactList}\item 
void \hyperlink{motionplus_8c_a082ffa1679f8bed1d10e1c96f9319ea3}{motion\-\_\-plus\-\_\-apply\-\_\-smoothing} (struct \hyperlink{structmotion__plus__t}{motion\-\_\-plus\-\_\-t} $\ast$mp)
\begin{DoxyCompactList}\small\item\em \-Apply smoothing to the \-Motion \-Plus gyroscopes. \end{DoxyCompactList}\item 
int \hyperlink{motionplus_8c_aafabc35ba07ffad49135ca5678249e88}{motion\-\_\-plus\-\_\-handshake} (struct \hyperlink{structwiimote__t}{wiimote\-\_\-t} $\ast$wm, \hyperlink{wiic__macros_8h_a0c8186d9b9b7880309c27230bbb5e69d}{byte} $\ast$data, unsigned short len)
\begin{DoxyCompactList}\small\item\em \-Handle the handshake from the \-Motion \-Plus. \end{DoxyCompactList}\item 
void \hyperlink{motionplus_8c_a82e596908b5c74fb0c19a1fc93153835}{wiic\-\_\-set\-\_\-motion\-\_\-plus} (struct \hyperlink{structwiimote__t}{wiimote\-\_\-t} $\ast$wm, int status)
\begin{DoxyCompactList}\small\item\em \-Control the \-Motion \-Plus support. \end{DoxyCompactList}\item 
void \hyperlink{motionplus_8c_ac5925b11d4c0677ad74a7fd7a179cd6f}{wiic\-\_\-calibrate\-\_\-motion\-\_\-plus} (struct \hyperlink{structmotion__plus__t}{motion\-\_\-plus\-\_\-t} $\ast$mp)
\begin{DoxyCompactList}\small\item\em \-Calibrate the \-Motion \-Plus gyroscopes. \end{DoxyCompactList}\item 
void \hyperlink{motionplus_8c_a76b05e15030cb08b17fab3e7c4d46e9c}{motion\-\_\-plus\-\_\-disconnected} (struct \hyperlink{structmotion__plus__t}{motion\-\_\-plus\-\_\-t} $\ast$mp)
\begin{DoxyCompactList}\small\item\em \-Notification of \-Motion \-Plus disconnection. \end{DoxyCompactList}\item 
void \hyperlink{motionplus_8c_a3c14c2a2ada82d49933a8fbf6fefe0aa}{wiic\-\_\-set\-\_\-mp\-\_\-threshold} (struct \hyperlink{structwiimote__t}{wiimote\-\_\-t} $\ast$wm, int threshold)
\begin{DoxyCompactList}\small\item\em \-Set the gyroscope event threshold. \end{DoxyCompactList}\item 
void \hyperlink{motionplus_8c_a98213839a4a3303df132fe863b3561ab}{wiic\-\_\-set\-\_\-mp\-\_\-smooth} (struct \hyperlink{structwiimote__t}{wiimote\-\_\-t} $\ast$wm, int status, float alpha)
\begin{DoxyCompactList}\small\item\em \-Enable the gyroscope smoothing (through an exponential moving average) \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{\-Detailed \-Description}
\-Motion \-Plus expansion device. 

\-Definition in file \hyperlink{motionplus_8c_source}{motionplus.\-c}.



\subsection{\-Function \-Documentation}
\hypertarget{motionplus_8c_a001ca4a571a8fc67ed0f3a16c50f05e0}{\index{motionplus.\-c@{motionplus.\-c}!calculate\-\_\-gyro\-\_\-rates@{calculate\-\_\-gyro\-\_\-rates}}
\index{calculate\-\_\-gyro\-\_\-rates@{calculate\-\_\-gyro\-\_\-rates}!motionplus.c@{motionplus.\-c}}
\subsubsection[{calculate\-\_\-gyro\-\_\-rates}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf calculate\-\_\-gyro\-\_\-rates} (
\begin{DoxyParamCaption}
\item[{struct {\bf motion\-\_\-plus\-\_\-t} $\ast$}]{mp, }
\item[{struct {\bf ang3s\-\_\-t} $\ast$}]{in, }
\item[{struct {\bf ang3f\-\_\-t} $\ast$}]{out}
\end{DoxyParamCaption}
)}}\label{motionplus_8c_a001ca4a571a8fc67ed0f3a16c50f05e0}


\-Convert raw data in deg/sec angular rates. 


\begin{DoxyParams}{\-Parameters}
{\em mp} & \-A pointer to a motionplus\-\_\-t structure.\\
\hline
\end{DoxyParams}
\-Subtract calibration data from raw data, and convert the difference in deg/sec angular rates. \-The function also considers the fast/slow rotation mode and performs very simple filtering for slow rotations. 

\-Definition at line 52 of file motionplus.\-c.

\hypertarget{motionplus_8c_a082ffa1679f8bed1d10e1c96f9319ea3}{\index{motionplus.\-c@{motionplus.\-c}!motion\-\_\-plus\-\_\-apply\-\_\-smoothing@{motion\-\_\-plus\-\_\-apply\-\_\-smoothing}}
\index{motion\-\_\-plus\-\_\-apply\-\_\-smoothing@{motion\-\_\-plus\-\_\-apply\-\_\-smoothing}!motionplus.c@{motionplus.\-c}}
\subsubsection[{motion\-\_\-plus\-\_\-apply\-\_\-smoothing}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf motion\-\_\-plus\-\_\-apply\-\_\-smoothing} (
\begin{DoxyParamCaption}
\item[{struct {\bf motion\-\_\-plus\-\_\-t} $\ast$}]{mp}
\end{DoxyParamCaption}
)}}\label{motionplus_8c_a082ffa1679f8bed1d10e1c96f9319ea3}


\-Apply smoothing to the \-Motion \-Plus gyroscopes. 


\begin{DoxyParams}{\-Parameters}
{\em mp} & \-Pointer to a \hyperlink{structmotion__plus__t}{motion\-\_\-plus\-\_\-t} structure. \\
\hline
\end{DoxyParams}


\-Definition at line 123 of file motionplus.\-c.

\hypertarget{motionplus_8c_a76b05e15030cb08b17fab3e7c4d46e9c}{\index{motionplus.\-c@{motionplus.\-c}!motion\-\_\-plus\-\_\-disconnected@{motion\-\_\-plus\-\_\-disconnected}}
\index{motion\-\_\-plus\-\_\-disconnected@{motion\-\_\-plus\-\_\-disconnected}!motionplus.c@{motionplus.\-c}}
\subsubsection[{motion\-\_\-plus\-\_\-disconnected}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf motion\-\_\-plus\-\_\-disconnected} (
\begin{DoxyParamCaption}
\item[{struct {\bf motion\-\_\-plus\-\_\-t} $\ast$}]{mp}
\end{DoxyParamCaption}
)}}\label{motionplus_8c_a76b05e15030cb08b17fab3e7c4d46e9c}


\-Notification of \-Motion \-Plus disconnection. 


\begin{DoxyParams}{\-Parameters}
{\em mp} & \-A pointer to a \hyperlink{structmotion__plus__t}{motion\-\_\-plus\-\_\-t} structure. \\
\hline
\end{DoxyParams}


\-Definition at line 250 of file motionplus.\-c.

\hypertarget{motionplus_8c_a0f2f989bf76980a687ee493613fdc896}{\index{motionplus.\-c@{motionplus.\-c}!motion\-\_\-plus\-\_\-event@{motion\-\_\-plus\-\_\-event}}
\index{motion\-\_\-plus\-\_\-event@{motion\-\_\-plus\-\_\-event}!motionplus.c@{motionplus.\-c}}
\subsubsection[{motion\-\_\-plus\-\_\-event}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf motion\-\_\-plus\-\_\-event} (
\begin{DoxyParamCaption}
\item[{struct {\bf motion\-\_\-plus\-\_\-t} $\ast$}]{mp, }
\item[{{\bf byte} $\ast$}]{msg}
\end{DoxyParamCaption}
)}}\label{motionplus_8c_a0f2f989bf76980a687ee493613fdc896}


\-Handle \-Motion \-Plus event. 


\begin{DoxyParams}{\-Parameters}
{\em mp} & \-A pointer to a motionplus\-\_\-t structure. \\
\hline
{\em msg} & \-The message specified in the event packet. \\
\hline
\end{DoxyParams}


\-Definition at line 89 of file motionplus.\-c.

\hypertarget{motionplus_8c_aafabc35ba07ffad49135ca5678249e88}{\index{motionplus.\-c@{motionplus.\-c}!motion\-\_\-plus\-\_\-handshake@{motion\-\_\-plus\-\_\-handshake}}
\index{motion\-\_\-plus\-\_\-handshake@{motion\-\_\-plus\-\_\-handshake}!motionplus.c@{motionplus.\-c}}
\subsubsection[{motion\-\_\-plus\-\_\-handshake}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf motion\-\_\-plus\-\_\-handshake} (
\begin{DoxyParamCaption}
\item[{struct {\bf wiimote\-\_\-t} $\ast$}]{wm, }
\item[{{\bf byte} $\ast$}]{data, }
\item[{unsigned short}]{len}
\end{DoxyParamCaption}
)}}\label{motionplus_8c_aafabc35ba07ffad49135ca5678249e88}


\-Handle the handshake from the \-Motion \-Plus. 


\begin{DoxyParams}{\-Parameters}
{\em wm} & \-A pointer to a \hyperlink{structwiimote__t}{wiimote\-\_\-t} structure. \\
\hline
{\em data} & \-The data that should contain the \-Motion \-Plus \-I\-D to check. \\
\hline
{\em len} & \-The length of the data block, in bytes.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{\-Returns}
\-Returns 1 if handshake was successful, 0 if not. 
\end{DoxyReturn}


\-Definition at line 141 of file motionplus.\-c.

\hypertarget{motionplus_8c_ac5925b11d4c0677ad74a7fd7a179cd6f}{\index{motionplus.\-c@{motionplus.\-c}!wiic\-\_\-calibrate\-\_\-motion\-\_\-plus@{wiic\-\_\-calibrate\-\_\-motion\-\_\-plus}}
\index{wiic\-\_\-calibrate\-\_\-motion\-\_\-plus@{wiic\-\_\-calibrate\-\_\-motion\-\_\-plus}!motionplus.c@{motionplus.\-c}}
\subsubsection[{wiic\-\_\-calibrate\-\_\-motion\-\_\-plus}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf wiic\-\_\-calibrate\-\_\-motion\-\_\-plus} (
\begin{DoxyParamCaption}
\item[{struct {\bf motion\-\_\-plus\-\_\-t} $\ast$}]{mp}
\end{DoxyParamCaption}
)}}\label{motionplus_8c_ac5925b11d4c0677ad74a7fd7a179cd6f}


\-Calibrate the \-Motion \-Plus gyroscopes. 


\begin{DoxyParams}{\-Parameters}
{\em mp} & \-Pointer to a \hyperlink{structmotion__plus__t}{motion\-\_\-plus\-\_\-t} structure.\\
\hline
\end{DoxyParams}
\-This should be called only after receiving the first values from the \-Motion \-Plus. 

\-Definition at line 237 of file motionplus.\-c.

\hypertarget{motionplus_8c_a82e596908b5c74fb0c19a1fc93153835}{\index{motionplus.\-c@{motionplus.\-c}!wiic\-\_\-set\-\_\-motion\-\_\-plus@{wiic\-\_\-set\-\_\-motion\-\_\-plus}}
\index{wiic\-\_\-set\-\_\-motion\-\_\-plus@{wiic\-\_\-set\-\_\-motion\-\_\-plus}!motionplus.c@{motionplus.\-c}}
\subsubsection[{wiic\-\_\-set\-\_\-motion\-\_\-plus}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf wiic\-\_\-set\-\_\-motion\-\_\-plus} (
\begin{DoxyParamCaption}
\item[{struct {\bf wiimote\-\_\-t} $\ast$}]{wm, }
\item[{int}]{status}
\end{DoxyParamCaption}
)}}\label{motionplus_8c_a82e596908b5c74fb0c19a1fc93153835}


\-Control the \-Motion \-Plus support. 


\begin{DoxyParams}{\-Parameters}
{\em wm} & \-Pointer to a \hyperlink{structwiimote__t}{wiimote\-\_\-t} structure. \\
\hline
{\em status} & \-Flag to control if the support should be enabled or not (1 to enable, 0 to disable). \\
\hline
\end{DoxyParams}


\-Definition at line 193 of file motionplus.\-c.

\hypertarget{motionplus_8c_a98213839a4a3303df132fe863b3561ab}{\index{motionplus.\-c@{motionplus.\-c}!wiic\-\_\-set\-\_\-mp\-\_\-smooth@{wiic\-\_\-set\-\_\-mp\-\_\-smooth}}
\index{wiic\-\_\-set\-\_\-mp\-\_\-smooth@{wiic\-\_\-set\-\_\-mp\-\_\-smooth}!motionplus.c@{motionplus.\-c}}
\subsubsection[{wiic\-\_\-set\-\_\-mp\-\_\-smooth}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf wiic\-\_\-set\-\_\-mp\-\_\-smooth} (
\begin{DoxyParamCaption}
\item[{struct {\bf wiimote\-\_\-t} $\ast$}]{wm, }
\item[{int}]{status, }
\item[{float}]{alpha}
\end{DoxyParamCaption}
)}}\label{motionplus_8c_a98213839a4a3303df132fe863b3561ab}


\-Enable the gyroscope smoothing (through an exponential moving average) 


\begin{DoxyParams}{\-Parameters}
{\em wm} & \-Pointer to a \hyperlink{structwiimote__t}{wiimote\-\_\-t} structure. \\
\hline
{\em status} & 1 to enable -\/ 0 to disable \\
\hline
{\em alpha} & \-Alpha smoothness parameter (between 0.\-0 and 1.\-0) \\
\hline
\end{DoxyParams}


\-Definition at line 275 of file motionplus.\-c.

\hypertarget{motionplus_8c_a3c14c2a2ada82d49933a8fbf6fefe0aa}{\index{motionplus.\-c@{motionplus.\-c}!wiic\-\_\-set\-\_\-mp\-\_\-threshold@{wiic\-\_\-set\-\_\-mp\-\_\-threshold}}
\index{wiic\-\_\-set\-\_\-mp\-\_\-threshold@{wiic\-\_\-set\-\_\-mp\-\_\-threshold}!motionplus.c@{motionplus.\-c}}
\subsubsection[{wiic\-\_\-set\-\_\-mp\-\_\-threshold}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf wiic\-\_\-set\-\_\-mp\-\_\-threshold} (
\begin{DoxyParamCaption}
\item[{struct {\bf wiimote\-\_\-t} $\ast$}]{wm, }
\item[{int}]{threshold}
\end{DoxyParamCaption}
)}}\label{motionplus_8c_a3c14c2a2ada82d49933a8fbf6fefe0aa}


\-Set the gyroscope event threshold. 


\begin{DoxyParams}{\-Parameters}
{\em wm} & \-Pointer to a \hyperlink{structwiimote__t}{wiimote\-\_\-t} structure. \\
\hline
{\em threshold} & \-The decimal place that should be considered a significant change. \\
\hline
\end{DoxyParams}


\-Definition at line 262 of file motionplus.\-c.

